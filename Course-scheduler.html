<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Scheduler - Personal Schedule Manager</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- Tailwind Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1e40af',
                        secondary: '#3b82f6',
                        accent: '#60a5fa',
                        light: '#f3f4f6',
                        dark: '#1f2937'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    },
                    boxShadow: {
                        'card': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                        'card-hover': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)'
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .glass-effect {
                background: rgba(255, 255, 255, 0.7);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.18);
            }
            .transition-all-300 {
                transition: all 0.3s ease;
            }
            .course-card {
                @apply relative p-3 rounded-lg-lg-2xl shadow-card transition-all-300 cursor-pointer border-l-4;
            }
            .course-card:hover {
                @apply shadow-card-hover transform -translate-y-1;
            }
            .btn-header {
                @apply text-sm font-medium text-gray-500 py-2 px-4 border-b;
            }
            .course-time {
                @apply text-xs text-gray-500 mt-1;
            }
            .btn {
                @apply px-4 py-2 rounded-md font-medium transition-all-300;
            }
            .btn-primary {
                @apply bg-primary text-white hover:bg-opacity-90;
            }
            .btn-secondary {
                @apply bg-secondary text-white hover:bg-opacity-90;
            }
            .btn-outline {
                @apply border border-gray-300 hover:bg-gray-100;
            }
            .form-input {
                @apply w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent;
            }
            .form-label {
                @apply block text-sm font-medium text-gray-700 mb-1;
            }
            .form-group {
                @apply mb-4;
            }
            .badge {
                @apply px-2 py-1 text-xs font-medium rounded-full;
            }
            .badge-primary {
                @apply bg-blue-100 text-blue-800;
            }
            .badge-success {
                @apply bg-green-100 text-green-800;
            }
            .badge-warning {
                @apply bg-yellow-100 text-yellow-800;
            }
            .badge-danger {
                @apply bg-red-100 text-red-800;
            }
            .tab {
                @apply px-4 py-2 font-medium border-b-2;
            }
            .tab-active {
                @apply border-primary text-primary;
            }
            .tab-inactive {
                @apply border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <div class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-primary text-white shadow-md">
            <div class="container mx-auto px-4 py-3 flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/78400dfe8b37474085f33079760f54e1~tplv-a9rns2rl98-image.image?rcl=202510022141208B8C805444A5F3075C93&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1762004524&x-signature=X%2FOcT9%2BPWSCVqKzaiKuFNgtEuaU%3D" alt="Class Scheduler Logo" class="h-10 w-10">
                    <h1 class="text-xl font-bold">Class Scheduler</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="theme-toggle" class="p-2 rounded-full hover:bg-blue-700 transition-all-300">
                        <i class="fa fa-moon-o"></i>
                    </button>
                    <button id="settings-btn" class="p-2 rounded-full hover:bg-blue-700 transition-all-300">
                        <i class="fa fa-cog"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-grow container mx-auto px-4 py-6">
            <div class="flex flex-col lg:flex-row gap-6">
                <!-- Sidebar -->
                <aside class="lg:w-1/4 bg-white rounded-xl shadow-md p-4">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-lg font-semibold text-gray-800">My Schedule</h2>
                        <button id="add-course-btn" class="btn btn-primary flex items-center">
                            <i class="fa fa-plus mr-2"></i> Add Course
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <h3 class="text-sm font-medium text-gray-500 mb-2">View Mode</h3>
                            <div class="flex border rounded-md overflow-hidden">
                                <button id="week-view-btn" class="tab tab-active flex-1">
                                    <i class="fa fa-calendar-o mr-1"></i> Week
                                </button>
                                <button id="day-view-btn" class="tab tab-inactive flex-1">
                                    <i class="fa fa-calendar-check-o mr-1"></i> Day
                                </button>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-sm font-medium text-gray-500 mb-2">Current Schedule</h3>
                            <div id="current-course" class="p-3 bg-blue-50 rounded-lg border border-blue-100">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-blue-800">Current Course</span>
                                    <span id="current-time" class="text-xs text-gray-500"></span>
                                </div>
                                <div id="no-current-course" class="mt-2 text-sm text-gray-500">
                                    No class currently in session
                                </div>
                                <div id="active-course" class="mt-2 hidden">
                                    <h4 id="active-course-name" class="font-medium text-gray-800"></h4>
                                    <div class="flex items-center mt-1 text-xs text-gray-600">
                                        <i class="fa fa-clock-o mr-1"></i>
                                        <span id="active-course-time"></span>
                                    </div>
                                    <div class="flex items-center mt-1 text-xs text-gray-600">
                                        <i class="fa fa-map-marker mr-1"></i>
                                        <span id="active-course-location"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-sm font-medium text-gray-500 mb-2">Upcoming</h3>
                            <div id="upcoming-courses" class="space-y-2">
                                <div id="no-upcoming-courses" class="p-3 bg-gray-50 rounded-lg text-sm text-gray-500">
                                    No upcoming courses
                                </div>
                                <!-- Upcoming courses will be dynamically added here -->
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-sm font-medium text-gray-500 mb-2">Actions</h3>
                            <div class="space-y-2">
                                <button id="export-data-btn" class="btn btn-outline w-full flex items-center justify-center">
                                    <i class="fa fa-download mr-2"></i> Export Data
                                </button>
                                <button id="import-data-btn" class="btn btn-outline w-full flex items-center justify-center">
                                    <i class="fa fa-upload mr-2"></i> Import Data
                                </button>
                                <button id="backup-data-btn" class="btn btn-outline w-full flex items-center justify-center">
                                    <i class="fa fa-cloud-upload mr-2"></i> Backup Data
                                </button>
                            </div>
                        </div>
                    </div>
                </aside>
                
                <!-- Course Schedule View -->
                <section class="lg:w-3/4 bg-white rounded-xl shadow-md overflow-hidden">
                    <div class="p-4 border-b">
                        <div class="flex justify-between items-center">
                            <h2 id="schedule-title" class="text-lg font-semibold text-gray-800">Weekly Schedule</h2>
                            <div class="flex space-x-2">
                                <button id="prev-week-btn" class="p-2 rounded-md hover:bg-gray-100">
                                    <i class="fa fa-chevron-left"></i>
                                </button>
                                <button id="today-btn" class="btn btn-outline text-sm">Today</button>
                                <button id="next-week-btn" class="p-2 rounded-md hover:bg-gray-100">
                                    <i class="fa fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                        <div id="current-date-range" class="text-sm text-gray-500 mt-1"></div>
                    </div>
                    
                    <!-- Week View -->
                    <div id="week-view" class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr>
                                    <th class="schedule-header w-24 text-left">Time</th>
                                    <th class="schedule-header">Monday</th>
                                    <th class="schedule-header">Tuesday</th>
                                    <th class="schedule-header">Wednesday</th>
                                    <th class="schedule-header">Thursday</th>
                                    <th class="schedule-header">Friday</th>
                                    <th class="schedule-header">Saturday</th>
                                    <th class="schedule-header">Sunday</th>
                                </tr>
                            </thead>
                            <tbody id="week-schedule-body">
                                <!-- Schedule rows will be dynamically generated here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Day View -->
                    <div id="day-view" class="overflow-x-auto hidden">
                        <table class="w-full">
                            <thead>
                                <tr>
                                    <th class="schedule-header w-24 text-left">Time</th>
                                    <th id="day-view-header" class="schedule-header">Monday</th>
                                </tr>
                            </thead>
                            <tbody id="day-schedule-body">
                                <!-- Schedule rows will be dynamically generated here -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-gray-800 text-white py-4">
            <div class="container mx-auto px-4 text-center text-sm">
                <p>Â© 2025 Class Scheduler - Personal Schedule Manager</p>
            </div>
        </footer>
    </div>

    <!-- Add/Edit Course Modal -->
    <div id="course-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6 transform transition-all-300 scale-95 opacity-0" id="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modal-title" class="text-lg font-semibold text-gray-800">Add New Course</h3>
                <button id="close-modal-btn" class="text-gray-400 hover:text-gray-600">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            <form id="course-form">
                <input type="hidden" id="course-id">
                <div class="form-group">
                    <label for="course-name" class="form-label">Course Name</label>
                    <input type="text" id="course-name" class="form-input" placeholder="e.g., Introduction to Computer Science" required>
                </div>
                <div class="form-group">
                    <label for="course-code" class="form-label">Course Code</label>
                    <input type="text" id="course-code" class="form-input" placeholder="e.g., CS101">
                </div>
                <div class="form-group">
                    <label for="course-teacher" class="form-label">Teacher</label>
                    <input type="text" id="course-teacher" class="form-input" placeholder="e.g., Dr. Smith">
                </div>
                <div class="form-group">
                    <label for="course-location" class="form-label">Location</label>
                    <input type="text" id="course-location" class="form-input" placeholder="e.g., Room 101">
                </div>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="form-group">
                        <label for="course-day" class="form-label">Day</label>
                        <select id="course-day" class="form-input" required>
                            <option value="0">Sunday</option>
                            <option value="1">Monday</option>
                            <option value="2">Tuesday</option>
                            <option value="3">Wednesday</option>
                            <option value="4">Thursday</option>
                            <option value="5">Friday</option>
                            <option value="6">Saturday</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="course-color" class="form-label">Color</label>
                        <input type="color" id="course-color" class="form-input h-10" value="#3b82f6">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="form-group">
                        <label for="course-start-time" class="form-label">Start Time</label>
                        <input type="time" id="course-start-time" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="course-end-time" class="form-label">End Time</label>
                        <input type="time" id="course-end-time" class="form-input" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="course-description" class="form-label">Description</label>
                    <textarea id="course-description" class="form-input" rows="2" placeholder="Optional course description"></textarea>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" id="cancel-course-btn" class="btn btn-outline">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Course</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6 transform transition-all-300 scale-95 opacity-0" id="settings-modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-800">Settings</h3>
                <button id="close-settings-btn" class="text-gray-400 hover:text-gray-600">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            <div class="space-y-4">
                <div>
                    <h4 class="text-sm font-medium text-gray-700 mb-2">Notifications</h4>
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-600">Enable reminders</span>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="enable-notifications" class="sr-only peer">
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                        </label>
                    </div>
                </div>
                <div>
                    <h4 class="text-sm font-medium text-gray-700 mb-2">Theme</h4>
                    <div class="flex space-x-2">
                        <button id="theme-light" class="btn btn-outline flex-1 text-sm">Light</button>
                        <button id="theme-dark" class="btn btn-outline flex-1 text-sm">Dark</button>
                        <button id="theme-system" class="btn btn-outline flex-1 text-sm">System</button>
                    </div>
                </div>
                <div>
                    <h4 class="text-sm font-medium text-gray-700 mb-2">Data Management</h4>
                    <button id="clear-data-btn" class="btn btn-outline w-full text-sm text-red-600 border-red-300 hover:bg-red-50">
                        Clear All Data
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notification-toast" class="fixed bottom-4 right-4 bg-white rounded-lg shadow-lg p-4 transform translate-y-full opacity-0 transition-all-300 z-50 max-w-sm">
        <div class="flex items-start">
            <div id="toast-icon" class="flex-shrink-0 h-6 w-6 flex items-center justify-center rounded-full mr-3">
                <i id="toast-icon-i" class="fa fa-check text-white"></i>
            </div>
            <div class="flex-1">
                <h4 id="toast-title" class="text-sm font-medium text-gray-800"></h4>
                <p id="toast-message" class="text-xs text-gray-500 mt-1"></p>
            </div>
            <button id="close-toast-btn" class="ml-4 text-gray-400 hover:text-gray-600">
                <i class="fa fa-times"></i>
            </button>
        </div>
    </div>

    <!-- Course Edit Menu (Hidden by default) -->
    <div id="course-edit-menu" class="absolute hidden bg-white rounded-md shadow-lg py-1 z-10">
        <button id="edit-course-menu-btn" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
            <i class="fa fa-pencil mr-2"></i> Edit
        </button>
        <button id="delete-course-menu-btn" class="block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100">
            <i class="fa fa-trash mr-2"></i> Delete
        </button>
    </div>

    <script>
        // Configuration Module
        const ConfigManager = {
            config: {
                viewMode: 'week',
                theme: 'light',
                notifications: true,
                lastUpdated: new Date().toISOString()
            },
            
            init() {
                const savedConfig = localStorage.getItem('classSchedulerConfig');
                if (savedConfig) {
                    this.config = JSON.parse(savedConfig);
                    this.applyConfig();
                }
            },
            
            get(key) {
                return this.config[key];
            },
            
            set(key, value) {
                this.config[key] = value;
                this.config.lastUpdated = new Date().toISOString();
                this.saveConfig();
                this.applyConfig();
            },
            
            saveConfig() {
                localStorage.setItem('classSchedulerConfig', JSON.stringify(this.config));
            },
            
            applyConfig() {
                // Apply view mode
                if (this.config.viewMode === 'week') {
                    document.getElementById('week-view').classList.remove('hidden');
                    document.getElementById('day-view').classList.add('hidden');
                    document.getElementById('week-view-btn').classList.add('tab-active');
                    document.getElementById('week-view-btn').classList.remove('tab-inactive');
                    document.getElementById('day-view-btn').classList.add('tab-inactive');
                    document.getElementById('day-view-btn').classList.remove('tab-active');
                    document.getElementById('schedule-title').textContent = 'Weekly Schedule';
                } else {
                    document.getElementById('week-view').classList.add('hidden');
                    document.getElementById('day-view').classList.remove('hidden');
                    document.getElementById('week-view-btn').classList.add('tab-inactive');
                    document.getElementById('week-view-btn').classList.remove('tab-active');
                    document.getElementById('day-view-btn').classList.add('tab-active');
                    document.getElementById('day-view-btn').classList.remove('tab-inactive');
                    document.getElementById('schedule-title').textContent = 'Daily Schedule';
                }
                
                // Apply theme
                if (this.config.theme === 'dark') {
                    document.documentElement.classList.add('dark');
                    document.getElementById('theme-toggle').innerHTML = '<i class="fa fa-sun-o"></i>';
                } else {
                    document.documentElement.classList.remove('dark');
                    document.getElementById('theme-toggle').innerHTML = '<i class="fa fa-moon-o"></i>';
                }
                
                // Apply notifications
                document.getElementById('enable-notifications').checked = this.config.notifications;
            }
        };

        // Data Management Module
        const DataManager = {
            courses: [],
            currentDate: new Date(),
            
            init() {
                this.loadCourses();
                this.updateCurrentDateRange();
            },
            
            loadCourses() {
                const savedCourses = localStorage.getItem('classSchedulerCourses');
                if (savedCourses) {
                    this.courses = JSON.parse(savedCourses);
                } else {
                    // Load sample data if no courses exist
                    this.loadSampleData();
                }
            },
            
            loadSampleData() {
                this.courses = [
                    {
                        id: '1',
                        name: 'Introduction to Computer Science',
                        code: 'CS101',
                        teacher: 'Dr. Alan Turing',
                        location: 'Room 101',
                        day: 1, // Monday
                        startTime: '09:00',
                        endTime: '10:30',
                        color: '#3b82f6',
                        description: 'Basic concepts of computer science and programming'
                    },
                    {
                        id: '2',
                        name: 'Mathematics for Engineers',
                        code: 'MATH205',
                        teacher: 'Prof. Katherine Johnson',
                        location: 'Room 205',
                        day: 1, // Monday
                        startTime: '11:00',
                        endTime: '12:30',
                        color: '#10b981',
                        description: 'Advanced calculus and linear algebra'
                    },
                    {
                        id: '3',
                        name: 'Physics I',
                        code: 'PHYS101',
                        teacher: 'Dr. Richard Feynman',
                        location: 'Lab 3',
                        day: 2, // Tuesday
                        startTime: '10:00',
                        endTime: '12:00',
                        color: '#f59e0b',
                        description: 'Introduction to classical mechanics'
                    },
                    {
                        id: '4',
                        name: 'Introduction to Psychology',
                        code: 'PSYCH101',
                        teacher: 'Dr. Carl Jung',
                        location: 'Auditorium A',
                        day: 3, // Wednesday
                        startTime: '14:00',
                        endTime: '15:30',
                        color: '#8b5cf6',
                        description: 'Basic concepts of psychology and human behavior'
                    },
                    {
                        id: '5',
                        name: 'World History',
                        code: 'HIST102',
                        teacher: 'Prof. Mary Beard',
                        location: 'Room 108',
                        day: 4, // Thursday
                        startTime: '11:00',
                        endTime: '12:30',
                        color: '#ec4899',
                        description: 'Global history from ancient civilizations to present'
                    },
                    {
                        id: '6',
                        name: 'Introduction to Economics',
                        code: 'ECON101',
                        teacher: 'Dr. Adam Smith',
                        location: 'Room 201',
                        day: 5, // Friday
                        startTime: '09:00',
                        endTime: '10:30',
                        color: '#06b6d4',
                        description: 'Basic principles of micro and macroeconomics'
                    }
                ];
                this.saveCourses();
            },
            
            saveCourses() {
                localStorage.setItem('classSchedulerCourses', JSON.stringify(this.courses));
                UIManager.renderSchedule();
                UIManager.updateCurrentAndUpcomingCourses();
            },
            
            addCourse(course) {
                course.id = Date.now().toString();
                this.courses.push(course);
                this.saveCourses();
                return course;
            },
            
            updateCourse(updatedCourse) {
                const index = this.courses.findIndex(course => course.id === updatedCourse.id);
                if (index !== -1) {
                    this.courses[index] = updatedCourse;
                    this.saveCourses();
                    return true;
                }
                return false;
            },
            
            deleteCourse(id) {
                const initialLength = this.courses.length;
                this.courses = this.courses.filter(course => course.id !== id);
                if (this.courses.length !== initialLength) {
                    this.saveCourses();
                    return true;
                }
                return false;
            },
            
            getCoursesByDay(day) {
                return this.courses.filter(course => course.day === day);
            },
            
            getCurrentCourse() {
                const now = new Date();
                const currentDay = now.getDay();
                const currentHours = now.getHours();
                const currentMinutes = now.getMinutes();
                const currentTimeInMinutes = currentHours * 60 + currentMinutes;
                
                return this.courses.find(course => {
                    if (course.day !== currentDay) return false;
                    
                    const [startHours, startMinutes] = course.startTime.split(':').map(Number);
                    const [endHours, endMinutes] = course.endTime.split(':').map(Number);
                    
                    const startTimeInMinutes = startHours * 60 + startMinutes;
                    const endTimeInMinutes = endHours * 60 + endMinutes;
                    
                    return currentTimeInMinutes >= startTimeInMinutes && currentTimeInMinutes <= endTimeInMinutes;
                });
            },
            
            getUpcomingCourses(count = 3) {
                const now = new Date();
                const currentDay = now.getDay();
                const currentHours = now.getHours();
                const currentMinutes = now.getMinutes();
                const currentTimeInMinutes = currentHours * 60 + currentMinutes;
                
                // Create a copy of courses to avoid modifying the original array
                const sortedCourses = [...this.courses].sort((a, b) => {
                    // Calculate total minutes for each course
                    const aTotalMinutes = a.day * 24 * 60 + 
                                        parseInt(a.startTime.split(':')[0]) * 60 + 
                                        parseInt(a.startTime.split(':')[1]);
                    
                    const bTotalMinutes = b.day * 24 * 60 + 
                                        parseInt(b.startTime.split(':')[0]) * 60 + 
                                        parseInt(b.startTime.split(':')[1]);
                    
                    return aTotalMinutes - bTotalMinutes;
                });
                
                // Filter upcoming courses
                const upcomingCourses = sortedCourses.filter(course => {
                    const courseTotalMinutes = course.day * 24 * 60 + 
                                            parseInt(course.startTime.split(':')[0]) * 60 + 
                                            parseInt(course.startTime.split(':')[1]);
                    
                    const currentTotalMinutes = currentDay * 24 * 60 + currentTimeInMinutes;
                    
                    return courseTotalMinutes > currentTotalMinutes;
                });
                
                // Return the first 'count' courses
                return upcomingCourses.slice(0, count);
            },
            
            exportData() {
                const data = {
                    courses: this.courses,
                    config: ConfigManager.config,
                    exportDate: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `class-scheduler-export-${new Date().toISOString().slice(0,10)}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            },
            
            importData(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    
                    reader.onload = (event) => {
                        try {
                            const data = JSON.parse(event.target.result);
                            
                            if (data.courses && Array.isArray(data.courses)) {
                                this.courses = data.courses;
                                this.saveCourses();
                            }
                            
                            if (data.config) {
                                ConfigManager.config = data.config;
                                ConfigManager.saveConfig();
                                ConfigManager.applyConfig();
                            }
                            
                            resolve(true);
                        } catch (error) {
                            reject(error);
                        }
                    };
                    
                    reader.onerror = () => {
                        reject(new Error('Failed to read file'));
                    };
                    
                    reader.readAsText(file);
                });
            },
            
            backupData() {
                const data = {
                    courses: this.courses,
                    config: ConfigManager.config,
                    backupDate: new Date().toISOString()
                };
                
                localStorage.setItem('classSchedulerBackup', JSON.stringify(data));
                return true;
            },
            
            restoreBackup() {
                const backupData = localStorage.getItem('classSchedulerBackup');
                if (backupData) {
                    const data = JSON.parse(backupData);
                    
                    if (data.courses && Array.isArray(data.courses)) {
                        this.courses = data.courses;
                        this.saveCourses();
                    }
                    
                    if (data.config) {
                        ConfigManager.config = data.config;
                        ConfigManager.saveConfig();
                        ConfigManager.applyConfig();
                    }
                    
                    return true;
                }
                return false;
            },
            
            clearAllData() {
                if (confirm('Are you sure you want to delete all your data? This action cannot be undone.')) {
                    this.courses = [];
                    localStorage.removeItem('classSchedulerCourses');
                    UIManager.renderSchedule();
                    UIManager.updateCurrentAndUpcomingCourses();
                    return true;
                }
                return false;
            },
            
            updateCurrentDateRange() {
                const now = this.currentDate;
                const startOfWeek = new Date(now);
                const day = now.getDay();
                const diff = now.getDate() - day + (day === 0 ? -6 : 1); // adjust when day is sunday
                startOfWeek.setDate(diff);
                
                const endOfWeek = new Date(startOfWeek);
                endOfWeek.setDate(endOfWeek.getDate() + 6);
                
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                document.getElementById('current-date-range').textContent = 
                    `${startOfWeek.toLocaleDateString('en-US', options)} - ${endOfWeek.toLocaleDateString('en-US', options)}`;
                
                // Update day view header
                const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
                document.getElementById('day-view-header').textContent = dayNames[now.getDay()];
            },
            
            goToPreviousWeek() {
                this.currentDate.setDate(this.currentDate.getDate() - 7);
                this.updateCurrentDateRange();
                UIManager.renderSchedule();
            },
            
            goToNextWeek() {
                this.currentDate.setDate(this.currentDate.getDate() + 7);
                this.updateCurrentDateRange();
                UIManager.renderSchedule();
            },
            
            goToToday() {
                this.currentDate = new Date();
                this.updateCurrentDateRange();
                UIManager.renderSchedule();
            }
        };

        // UI Management Module
        const UIManager = {
            init() {
                this.setupEventListeners();
                this.renderSchedule();
                this.updateCurrentAndUpcomingCourses();
                this.startCurrentTimeUpdate();
            },
            
            setupEventListeners() {
                // View mode toggle
                document.getElementById('week-view-btn').addEventListener('click', () => {
                    ConfigManager.set('viewMode', 'week');
                });
                
                document.getElementById('day-view-btn').addEventListener('click', () => {
                    ConfigManager.set('viewMode', 'day');
                });
                
                // Date navigation
                document.getElementById('prev-week-btn').addEventListener('click', () => {
                    DataManager.goToPreviousWeek();
                });
                
                document.getElementById('next-week-btn').addEventListener('click', () => {
                    DataManager.goToNextWeek();
                });
                
                document.getElementById('today-btn').addEventListener('click', () => {
                    DataManager.goToToday();
                });
                
                // Add course modal
                document.getElementById('add-course-btn').addEventListener('click', () => {
                    this.openAddCourseModal();
                });
                
                document.getElementById('close-modal-btn').addEventListener('click', () => {
                    this.closeCourseModal();
                });
                
                document.getElementById('cancel-course-btn').addEventListener('click', () => {
                    this.closeCourseModal();
                });
                
                document.getElementById('course-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveCourseForm();
                });
                
                // Settings modal
                document.getElementById('settings-btn').addEventListener('click', () => {
                    this.openSettingsModal();
                });
                
                document.getElementById('close-settings-btn').addEventListener('click', () => {
                    this.closeSettingsModal();
                });
                
                // Theme toggle
                document.getElementById('theme-toggle').addEventListener('click', () => {
                    const currentTheme = ConfigManager.get('theme');
                    ConfigManager.set('theme', currentTheme === 'dark' ? 'light' : 'dark');
                });
                
                // Theme settings
                document.getElementById('theme-light').addEventListener('click', () => {
                    ConfigManager.set('theme', 'light');
                });
                
                document.getElementById('theme-dark').addEventListener('click', () => {
                    ConfigManager.set('theme', 'dark');
                });
                
                document.getElementById('theme-system').addEventListener('click', () => {
                    ConfigManager.set('theme', 'system');
                });
                
                // Notifications toggle
                document.getElementById('enable-notifications').addEventListener('change', (e) => {
                    ConfigManager.set('notifications', e.target.checked);
                });
                
                // Data management
                document.getElementById('export-data-btn').addEventListener('click', () => {
                    DataManager.exportData();
                    this.showNotification('Success', 'Data exported successfully', 'success');
                });
                
                document.getElementById('import-data-btn').addEventListener('click', () => {
                    // Create a hidden file input
                    const fileInput = document.createElement('input');
                    fileInput.type = 'file';
                    fileInput.accept = '.json';
                    
                    fileInput.onchange = (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            DataManager.importData(file)
                                .then(() => {
                                    this.showNotification('Success', 'Data imported successfully', 'success');
                                })
                                .catch((error) => {
                                    this.showNotification('Error', 'Failed to import data: ' + error.message, 'error');
                                });
                        }
                    };
                    
                    fileInput.click();
                });
                
                document.getElementById('backup-data-btn').addEventListener('click', () => {
                    if (DataManager.backupData()) {
                        this.showNotification('Success', 'Data backed up successfully', 'success');
                    } else {
                        this.showNotification('Error', 'Failed to backup data', 'error');
                    }
                });
                
                document.getElementById('clear-data-btn').addEventListener('click', () => {
                    if (DataManager.clearAllData()) {
                        this.showNotification('Success', 'All data cleared', 'success');
                    }
                });
                
                // Notification toast
                document.getElementById('close-toast-btn').addEventListener('click', () => {
                    this.hideNotification();
                });
                
                // Course edit menu
                document.getElementById('edit-course-menu-btn').addEventListener('click', () => {
                    const courseId = document.getElementById('course-edit-menu').dataset.courseId;
                    this.closeCourseEditMenu();
                    this.openEditCourseModal(courseId);
                });
                
                document.getElementById('delete-course-menu-btn').addEventListener('click', () => {
                    const courseId = document.getElementById('course-edit-menu').dataset.courseId;
                    this.closeCourseEditMenu();
                    
                    if (confirm('Are you sure you want to delete this course?')) {
                        if (DataManager.deleteCourse(courseId)) {
                            this.showNotification('Success', 'Course deleted successfully', 'success');
                        } else {
                            this.showNotification('Error', 'Failed to delete course', 'error');
                        }
                    }
                });
            },
            
            renderSchedule() {
                if (ConfigManager.get('viewMode') === 'week') {
                    this.renderWeekView();
                } else {
                    this.renderDayView();
                }
            },
            
            renderWeekView() {
                const tableBody = document.getElementById('week-schedule-body');
                tableBody.innerHTML = '';
                
                // Generate time slots from 7:00 AM to 9:00 PM
                for (let hour = 7; hour <= 21; hour++) {
                    const row = document.createElement('tr');
                    row.className = 'border-b';
                    
                    // Time cell
                    const timeCell = document.createElement('td');
                    timeCell.className = 'py-4 px-4 text-sm font-medium text-gray-500 border-r';
                    timeCell.textContent = `${hour % 12 || 12}:00 ${hour < 12 ? 'AM' : 'PM'}`;
                    row.appendChild(timeCell);
                    
                    // Day cells (Monday to Sunday)
                    for (let day = 0; day < 7; day++) {
                        const dayCell = document.createElement('td');
                        dayCell.className = 'py-1 px-1 relative';
                        
                        // Get courses for this day
                        const courses = DataManager.getCoursesByDay(day);
                        
                        // Filter courses that start at this hour
                        const hourCourses = courses.filter(course => {
                            const startHour = parseInt(course.startTime.split(':')[0]);
                            return startHour === hour;
                        });
                        
                        // Add courses to the cell
                        hourCourses.forEach(course => {
                            const courseCard = this.createCourseCard(course);
                            dayCell.appendChild(courseCard);
                        });
                        
                        row.appendChild(dayCell);
                    }
                    
                    tableBody.appendChild(row);
                }
            },
            
            renderDayView() {
                const tableBody = document.getElementById('day-schedule-body');
                tableBody.innerHTML = '';
                
                const currentDay = DataManager.currentDate.getDay();
                
                // Generate time slots from 7:00 AM to 9:00 PM
                for (let hour = 7; hour <= 21; hour++) {
                    const row = document.createElement('tr');
                    row.className = 'border-b';
                    
                    // Time cell
                    const timeCell = document.createElement('td');
                    timeCell.className = 'py-4 px-4 text-sm font-medium text-gray-500 border-r';
                    timeCell.textContent = `${hour % 12 || 12}:00 ${hour < 12 ? 'AM' : 'PM'}`;
                    row.appendChild(timeCell);
                    
                    // Day cell
                    const dayCell = document.createElement('td');
                    dayCell.className = 'py-1 px-1 relative';
                    
                    // Get courses for this day
                    const courses = DataManager.getCoursesByDay(currentDay);
                    
                    // Filter courses that start at this hour
                    const hourCourses = courses.filter(course => {
                        const startHour = parseInt(course.startTime.split(':')[0]);
                        return startHour === hour;
                    });
                    
                    // Add courses to the cell
                    hourCourses.forEach(course => {
                        const courseCard = this.createCourseCard(course);
                        dayCell.appendChild(courseCard);
                    });
                    
                    row.appendChild(dayCell);
                }
            },
            
            createCourseCard(course) {
                const courseCard = document.createElement('div');
                courseCard.className = 'course-card';
                courseCard.style.borderLeftColor = course.color;
                courseCard.style.backgroundColor = `${course.color}15`; // Light version of the color
                courseCard.dataset.courseId = course.id;
                
                // Course name
                const courseName = document.createElement('div');
                courseName.className = 'font-medium text-gray-800';
                courseName.textContent = course.name;
                courseCard.appendChild(courseName);
                
                // Course code (if available)
                if (course.code) {
                    const courseCode = document.createElement('div');
                    courseCode.className = 'text-xs text-gray-500';
                    courseCode.textContent = course.code;
                    courseCard.appendChild(courseCode);
                }
                
                // Course time
                const courseTime = document.createElement('div');
                courseTime.className = 'course-time';
                courseTime.textContent = `${course.startTime} - ${course.endTime}`;
                courseCard.appendChild(courseTime);
                
                // Course location (if available)
                if (course.location) {
                    const courseLocation = document.createElement('div');
                    courseLocation.className = 'text-xs text-gray-500';
                    courseLocation.textContent = course.location;
                    courseCard.appendChild(courseLocation);
                }
                
                // Add click event for edit menu
                courseCard.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    this.openCourseEditMenu(course.id, e.clientX, e.clientY);
                });
                
                // Close edit menu when clicking elsewhere
                document.addEventListener('click', (e) => {
                    if (!document.getElementById('course-edit-menu').contains(e.target) && 
                        e.target !== courseCard && 
                        !courseCard.contains(e.target)) {
                        this.closeCourseEditMenu();
                    }
                });
                
                return courseCard;
            },
            
            updateCurrentAndUpcomingCourses() {
                // Update current course
                const currentCourse = DataManager.getCurrentCourse();
                const noCurrentCourseEl = document.getElementById('no-current-course');
                const activeCourseEl = document.getElementById('active-course');
                
                if (currentCourse) {
                    noCurrentCourseEl.classList.add('hidden');
                    activeCourseEl.classList.remove('hidden');
                    
                    document.getElementById('active-course-name').textContent = currentCourse.name;
                    document.getElementById('active-course-time').textContent = `${currentCourse.startTime} - ${currentCourse.endTime}`;
                    document.getElementById('active-course-location').textContent = currentCourse.location || 'No location provided';
                    
                    // Add border color
                    activeCourseEl.style.borderLeftColor = currentCourse.color;
                    activeCourseEl.classList.add('border-l-4', 'pl-3');
                } else {
                    noCurrentCourseEl.classList.remove('hidden');
                    activeCourseEl.classList.add('hidden');
                }
                
                // Update upcoming courses
                const upcomingCourses = DataManager.getUpcomingCourses();
                const upcomingCoursesEl = document.getElementById('upcoming-courses');
                const noUpcomingCoursesEl = document.getElementById('no-upcoming-courses');
                
                if (upcomingCourses.length > 0) {
                    noUpcomingCoursesEl.classList.add('hidden');
                    
                    // Clear existing upcoming courses
                    while (upcomingCoursesEl.children.length > 1) {
                        upcomingCoursesEl.removeChild(upcomingCoursesEl.lastChild);
                    }
                    
                    // Add upcoming courses
                    upcomingCourses.forEach(course => {
                        const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
                        
                        const courseEl = document.createElement('div');
                        courseEl.className = 'p-3 bg-gray-50 rounded-lg';
                        courseEl.style.borderLeftColor = course.color;
                        courseEl.classList.add('border-l-4');
                        
                        const courseName = document.createElement('div');
                        courseName.className = 'font-medium text-gray-800 text-sm';
                        courseName.textContent = course.name;
                        courseEl.appendChild(courseName);
                        
                        const courseInfo = document.createElement('div');
                        courseInfo.className = 'flex items-center justify-between mt-1 text-xs text-gray-500';
                        
                        const courseDayTime = document.createElement('div');
                        courseDayTime.textContent = `${dayNames[course.day]} â¢ ${course.startTime}`;
                        courseInfo.appendChild(courseDayTime);
                        
                        const courseLocation = document.createElement('div');
                        courseLocation.textContent = course.location || '';
                        courseInfo.appendChild(courseLocation);
                        
                        courseEl.appendChild(courseInfo);
                        upcomingCoursesEl.appendChild(courseEl);
                    });
                } else {
                    noUpcomingCoursesEl.classList.remove('hidden');
                    
                    // Clear existing upcoming courses
                    while (upcomingCoursesEl.children.length > 1) {
                        upcomingCoursesEl.removeChild(upcomingCoursesEl.lastChild);
                    }
                }
            },
            
            startCurrentTimeUpdate() {
                // Update current time display
                const updateCurrentTime = () => {
                    const now = new Date();
                    const options = { hour: '2-digit', minute: '2-digit', hour12: true };
                    document.getElementById('current-time').textContent = now.toLocaleTimeString('en-US', options);
                };
                
                // Update every minute
                updateCurrentTime();
                setInterval(updateCurrentTime, 60000);
                
                // Update current and upcoming courses every 5 minutes
                setInterval(() => {
                    this.updateCurrentAndUpcomingCourses();
                }, 300000);
            },
            
            openAddCourseModal() {
                document.getElementById('modal-title').textContent = 'Add New Course';
                document.getElementById('course-form').reset();
                document.getElementById('course-id').value = '';
                
                // Set default values
                document.getElementById('course-day').value = new Date().getDay();
                document.getElementById('course-color').value = '#3b82f6';
                
                // Show modal
                this.openModal('course-modal');
            },
            
            openEditCourseModal(courseId) {
                const course = DataManager.courses.find(c => c.id === courseId);
                if (!course) return;
                
                document.getElementById('modal-title').textContent = 'Edit Course';
                document.getElementById('course-id').value = course.id;
                document.getElementById('course-name').value = course.name;
                document.getElementById('course-code').value = course.code || '';
                document.getElementById('course-teacher').value = course.teacher || '';
                document.getElementById('course-location').value = course.location || '';
                document.getElementById('course-day').value = course.day;
                document.getElementById('course-start-time').value = course.startTime;
                document.getElementById('course-end-time').value = course.endTime;
                document.getElementById('course-color').value = course.color;
                document.getElementById('course-description').value = course.description || '';
                
                // Show modal
                this.openModal('course-modal');
            },
            
            closeCourseModal() {
                this.closeModal('course-modal');
            },
            
            saveCourseForm() {
                const courseId = document.getElementById('course-id').value;
                const courseData = {
                    name: document.getElementById('course-name').value,
                    code: document.getElementById('course-code').value,
                    teacher: document.getElementById('course-teacher').value,
                    location: document.getElementById('course-location').value,
                    day: parseInt(document.getElementById('course-day').value),
                    startTime: document.getElementById('course-start-time').value,
                    endTime: document.getElementById('course-end-time').value,
                    color: document.getElementById('course-color').value,
                    description: document.getElementById('course-description').value
                };
                
                try {
                    if (courseId) {
                        // Update existing course
                        courseData.id = courseId;
                        if (DataManager.updateCourse(courseData)) {
                            this.showNotification('Success', 'Course updated successfully', 'success');
                        } else {
                            this.showNotification('Error', 'Failed to update course', 'error');
                        }
                    } else {
                        // Add new course
                        if (DataManager.addCourse(courseData)) {
                            this.showNotification('Success', 'Course added successfully', 'success');
                        } else {
                            this.showNotification('Error', 'Failed to add course', 'error');
                        }
                    }
                    
                    this.closeCourseModal();
                } catch (error) {
                    this.showNotification('Error', error.message, 'error');
                }
            },
            
            openSettingsModal() {
                this.openModal('settings-modal');
            },
            
            closeSettingsModal() {
                this.closeModal('settings-modal');
            },
            
            openModal(modalId) {
                const modal = document.getElementById(modalId);
                const modalContent = document.getElementById(`${modalId}-content`) || document.getElementById('modal-content');
                
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
            },
            
            closeModal(modalId) {
                const modal = document.getElementById(modalId);
                const modalContent = document.getElementById(`${modalId}-content`) || document.getElementById('modal-content');
                
                modalContent.classList.remove('scale-100', 'opacity-100');
                modalContent.classList.add('scale-95', 'opacity-0');
                
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            },
            
            openCourseEditMenu(courseId, x, y) {
                const menu = document.getElementById('course-edit-menu');
                menu.dataset.courseId = courseId;
                
                // Position the menu
                menu.style.left = `${x}px`;
                menu.style.top = `${y}px`;
                
                // Show the menu
                menu.classList.remove('hidden');
            },
            
            closeCourseEditMenu() {
                const menu = document.getElementById('course-edit-menu');
                menu.classList.add('hidden');
            },
            
            showNotification(title, message, type = 'info') {
                const toast = document.getElementById('notification-toast');
                const toastTitle = document.getElementById('toast-title');
                const toastMessage = document.getElementById('toast-message');
                const toastIcon = document.getElementById('toast-icon');
                const toastIconI = document.getElementById('toast-icon-i');
                
                // Set content
                toastTitle.textContent = title;
                toastMessage.textContent = message;
                
                // Set icon and color based on type
                switch (type) {
                    case 'success':
                        toastIcon.className = 'flex-shrink-0 h-6 w-6 flex items-center justify-center rounded-full mr-3 bg-green-500';
                        toastIconI.className = 'fa fa-check text-white';
                        break;
                    case 'error':
                        toastIcon.className = 'flex-shrink-0 h-6 w-6 flex items-center justify-center rounded-full mr-3 bg-red-500';
                        toastIconI.className = 'fa fa-times text-white';
                        break;
                    case 'warning':
                        toastIcon.className = 'flex-shrink-0 h-6 w-6 flex items-center justify-center rounded-full mr-3 bg-yellow-500';
                        toastIconI.className = 'fa fa-exclamation text-white';
                        break;
                    default:
                        toastIcon.className = 'flex-shrink-0 h-6 w-6 flex items-center justify-center rounded-full mr-3 bg-blue-500';
                        toastIconI.className = 'fa fa-info text-white';
                }
                
                // Show toast
                toast.classList.remove('translate-y-full', 'opacity-0');
                toast.classList.add('translate-y-0', 'opacity-100');
                
                // Auto hide after 5 seconds
                clearTimeout(this.toastTimeout);
                this.toastTimeout = setTimeout(() => {
                    this.hideNotification();
                }, 5000);
            },
            
            hideNotification() {
                const toast = document.getElementById('notification-toast');
                toast.classList.remove('translate-y-0', 'opacity-100');
                toast.classList.add('translate-y-full', 'opacity-0');
            }
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            ConfigManager.init();
            DataManager.init();
            UIManager.init();
        });
    </script>
</body>
</html>
